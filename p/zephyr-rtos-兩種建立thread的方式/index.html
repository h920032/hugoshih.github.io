<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Zephyr RTOS 兩種建立Thread的方式"><title>Zephyr RTOS 兩種建立Thread的方式</title>
<link rel=canonical href=https://www.hugoshih.com/p/zephyr-rtos-%E5%85%A9%E7%A8%AE%E5%BB%BA%E7%AB%8Bthread%E7%9A%84%E6%96%B9%E5%BC%8F/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Zephyr RTOS 兩種建立Thread的方式"><meta property='og:description' content="Zephyr RTOS 兩種建立Thread的方式"><meta property='og:url' content='https://www.hugoshih.com/p/zephyr-rtos-%E5%85%A9%E7%A8%AE%E5%BB%BA%E7%AB%8Bthread%E7%9A%84%E6%96%B9%E5%BC%8F/'><meta property='og:site_name' content='Hsing-Yu Shih'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Embedded'><meta property='article:tag' content='RTOS'><meta property='article:tag' content='Zephyr'><meta property='article:published_time' content='2025-01-05T22:20:31+08:00'><meta property='article:modified_time' content='2025-01-05T22:20:31+08:00'><meta property='og:image' content='https://i.imgur.com/V5OSNcL.jpg'><meta name=twitter:title content="Zephyr RTOS 兩種建立Thread的方式"><meta name=twitter:description content="Zephyr RTOS 兩種建立Thread的方式"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://i.imgur.com/V5OSNcL.jpg'><link rel="shortcut icon" href=/img/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_819cc45341d19fd1.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Hsing-Yu Shih</a></h1><h2 class=site-description>Software Program Manager @ Microsoft
| Chase excellence, success will follow you.</h2></div></header><ol class=menu-social><li><a href=mailto:h920032@gmail.com target=_blank title=Mail rel=me><svg class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><desc>Download more icon variants from https://tabler-icons.io/i/mail</desc><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg></a></li><li><a href=https://github.com/h920032 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/hugoshih/ target=_blank title=Linkedin rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><desc>Download more icon variants from https://tabler-icons.io/i/brand-linkedin</desc><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=/files/cv_latex.pdf target=_blank title=Resume rel=me><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg></a></li><li><a href=https://orcid.org/0000-0003-4111-3768 target=_blank title=Research rel=me><svg class="icon icon-tabler icon-tabler-school" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><desc>Download more icon variants from https://tabler-icons.io/i/school</desc><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 9 12 5 2 9l10 4 10-4v6"/><path d="M6 10.6V16a6 3 0 0012 0v-5.4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#thread-執行緒>Thread (執行緒)</a></li><li><a href=#zephyr-建立執行緒的兩種常見方法>Zephyr 建立執行緒的兩種常見方法</a><ol><li><a href=#在編譯期間compile-time建立執行緒>在編譯期間（Compile Time）建立執行緒</a><ol><li><a href=#k_thread_define>K_THREAD_DEFINE()</a></li></ol></li><li><a href=#在執行期間run-time建立執行緒>在執行期間（Run Time）建立執行緒</a><ol><li><a href=#k_thread_create>k_thread_create()</a></li></ol></li></ol></li><li><a href=#範例>範例</a><ol><li><a href=#在編譯期間compile-time動態建立執行緒範例>在編譯期間（Compile Time）動態建立執行緒範例</a></li><li><a href=#在執行期run-time動態建立執行緒範例>在執行期（Run Time）動態建立執行緒範例</a></li></ol></li><li><a href=#比較>比較</a></li><li><a href=#總結>總結</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/zephyr-rtos-%E5%85%A9%E7%A8%AE%E5%BB%BA%E7%AB%8Bthread%E7%9A%84%E6%96%B9%E5%BC%8F/><img src=https://i.imgur.com/V5OSNcL.jpg loading=lazy alt="Featured image of post Zephyr RTOS 兩種建立Thread的方式"></a></div><div class=article-details><header class=article-category><a href=/categories/embedded/>Embedded</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/zephyr-rtos-%E5%85%A9%E7%A8%AE%E5%BB%BA%E7%AB%8Bthread%E7%9A%84%E6%96%B9%E5%BC%8F/>Zephyr RTOS 兩種建立Thread的方式</a></h2><h3 class=article-subtitle>Zephyr RTOS 兩種建立Thread的方式</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 05, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><h1 id=zephyr-rtos-兩種建立thread的方式>Zephyr RTOS 兩種建立Thread的方式</h1><h2 id=thread-執行緒>Thread (執行緒)</h2><p>在 Zephyr OS中，每個獨立的功能或任務可以放在不同的執行緒中執行，內部使用了輕量級的排程器，可以根據不同執行緒的優先級，以及執行緒本身的狀態（ready, running, pending 等），來決定哪一個執行緒能夠先被 CPU 執行，執行緒可以有以下幾個性質：</p><ol><li>執行緒優先級（Priority）：數值越小表示優先級越高（Preemptive scheduling 的情況下）。</li><li>堆疊大小（Stack Size）：每個執行緒必須設定自己的堆疊空間，Zephyr 會在執行緒切換時儲存或恢復執行緒的上下文。</li><li>執行緒生命週期（Lifecycle）：可以在編譯期就被預先配置好，或在執行期動態配置與建立。</li></ol><h2 id=zephyr-建立執行緒的兩種常見方法>Zephyr 建立執行緒的兩種常見方法</h2><h3 id=在編譯期間compile-time建立執行緒>在編譯期間（Compile Time）建立執行緒</h3><p>Zephyr 提供了一個巨集 <code>K_THREAD_DEFINE()</code> 用於在編譯期就宣告並建立執行緒。只要程式一開啟並初始化 RTOS 後，這些執行緒就會自動被建立並進入排程器的管理。</p><h4 id=k_thread_define>K_THREAD_DEFINE()</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define K_THREAD_DEFINE(name, stack_size, entry_fn, p1, p2, p3,       \
</span></span></span><span class=line><span class=cl><span class=cp>                        prio, options, delay)
</span></span></span></code></pre></td></tr></table></div></div><ul><li>name：此執行緒的識別名稱，同時會生成一個 k_tid_t 型態的變數。</li><li>stack_size：此執行緒的堆疊大小（以 byte 為單位）。</li><li>entry_fn：此執行緒進入點函式（thread function），開始執行時要跑哪個函式。</li><li>p1, p2, p3：最多可傳入三個參數給進入點函式使用（都為 void* 型態）。</li><li>prio：優先級（數值越小，優先級越高）。</li><li>options：執行緒選項，通常先給 0 表示沒有特別的額外設定。</li><li>delay：執行緒開始之前的延遲時間（ticks 或毫秒），若填 0 表示不延遲，立即就緒。</li></ul><h3 id=在執行期間run-time建立執行緒>在執行期間（Run Time）建立執行緒</h3><p>另一種是在程式運行期間建立執行緒，使用 API 函數<code>k_thread_create()</code> 建立執行緒。這種方法在有些情況下會更具彈性，例如依據狀態或條件，動態啟動或終止執行緒，以免靜態建立過多浪費資源。</p><h4 id=k_thread_create>k_thread_create()</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>k_tid_t</span> <span class=nf>k_thread_create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>k_thread</span> <span class=o>*</span><span class=n>new_thread</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>k_thread_stack_t</span> <span class=o>*</span><span class=n>stack</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>size_t</span> <span class=n>stack_size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>k_thread_entry_t</span> <span class=n>entry</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>prio</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>options</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>k_timeout_t</span> <span class=n>delay</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>new_thread：指向使用者自行宣告的 struct k_thread 物件，用來儲存此執行緒的控制區塊。</li><li>stack：指向此執行緒對應的堆疊空間（需先以 <code>K_THREAD_STACK_DEFINE()</code> 靜態或動態配置）。</li><li>stack_size：此堆疊的大小。</li><li>entry：執行緒執行的進入點函式。</li><li>p1, p2, p3：最多可傳入三個參數到執行緒函式。</li><li>prio：優先級。</li><li>options：執行緒選項，常用為 0。</li><li>delay：執行緒開始前是否要延遲。</li></ul><h2 id=範例>範例</h2><p>以下兩段程式碼，分別示範用 <code>K_THREAD_DEFINE()</code>（在編譯期間）或 <code>k_thread_create()</code>（在執行期間）建立兩個執行緒，分別執行 LED 漸亮漸暗（fade_led） 與 LED 閃爍（toggle_led） 的功能
<a class=link href=https://github.com/h920032/Zephyr-blinky-toggle-demo target=_blank rel=noopener>github repo</a>
以下是在Nucleo-F303K8的執行結果，左邊LED執行toggle，右邊執行fading
<img src=https://imgur.com/V0jJ9bs.gif loading=lazy></p><h3 id=在編譯期間compile-time動態建立執行緒範例>在編譯期間（Compile Time）動態建立執行緒範例</h3><ol><li><code>K_THREAD_DEFINE(fade_tid, 512, fade_led, NULL, NULL, NULL, 5, 0, 0);</code><ul><li>建立一個名為 fade_tid 的執行緒，堆疊大小 512 bytes，執行函式為 fade_led，優先級 5。</li><li>p1, p2, p3 都填 NULL，表示不需要傳遞參數。</li></ul></li><li><code>K_THREAD_DEFINE(toggle_tid, 512, toggle_led, NULL, NULL, NULL, 5, 0, 0);</code><ul><li>同樣建立名為 toggle_tid 的執行緒，stack大小、優先級參數與上面一致，執行函式為 toggle_led。</li></ul></li></ol><p>這些執行緒在編譯的時候就已經被「靜態配置」了，所以當系統啟動並執行到 main() 時，它們也就由排程器自動啟動並不斷執行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;zephyr/kernel.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;zephyr/sys/printk.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;zephyr/device.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;zephyr/drivers/pwm.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;zephyr/drivers/gpio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>fade_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>toggle_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 利用 DT_ALIAS(pwm_led0) 與 DT_ALIAS(led1) 取得裝置樹中的設備訊息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=k>const</span> <span class=k>struct</span> <span class=n>pwm_dt_spec</span> <span class=n>pwm_led0</span> <span class=o>=</span> <span class=nf>PWM_DT_SPEC_GET</span><span class=p>(</span><span class=nf>DT_ALIAS</span><span class=p>(</span><span class=n>pwm_led0</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=k>struct</span> <span class=n>gpio_dt_spec</span> <span class=n>led1</span> <span class=o>=</span> <span class=nf>GPIO_DT_SPEC_GET</span><span class=p>(</span><span class=nf>DT_ALIAS</span><span class=p>(</span><span class=n>led1</span><span class=p>),</span> <span class=n>gpios</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 這裡定義一些常數用於控制漸亮漸暗的速度或節拍
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define NUM_STEPS       256U
</span></span></span><span class=line><span class=cl><span class=cp>#define SLEEP_MSEC      5U
</span></span></span><span class=line><span class=cl><span class=cp>#define SLEEP_TIME_MS   500
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// 在編譯期間靜態建立兩個執行緒
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>K_THREAD_DEFINE</span><span class=p>(</span><span class=n>fade_tid</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=n>fade_led</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>K_THREAD_DEFINE</span><span class=p>(</span><span class=n>toggle_tid</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=n>toggle_led</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// fade_led 會透過 PWM 設定脈寬來控制 LED 的亮度，製造 &#34;呼吸燈&#34; 效果
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>fade_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>pulse_width</span> <span class=o>=</span> <span class=mi>0U</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>step</span> <span class=o>=</span> <span class=n>pwm_led0</span><span class=p>.</span><span class=n>period</span> <span class=o>/</span> <span class=n>NUM_STEPS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint8_t</span> <span class=n>dir</span> <span class=o>=</span> <span class=mi>1U</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 設定當前的脈寬
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>pwm_set_pulse_dt</span><span class=p>(</span><span class=o>&amp;</span><span class=n>pwm_led0</span><span class=p>,</span> <span class=n>pulse_width</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 調整脈寬，控制 LED 往漸亮或漸暗方向
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>dir</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>pulse_width</span> <span class=o>+=</span> <span class=n>step</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>pulse_width</span> <span class=o>&gt;=</span> <span class=n>pwm_led0</span><span class=p>.</span><span class=n>period</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>pulse_width</span> <span class=o>=</span> <span class=n>pwm_led0</span><span class=p>.</span><span class=n>period</span> <span class=o>-</span> <span class=n>step</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>dir</span> <span class=o>=</span> <span class=mi>0U</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>pulse_width</span> <span class=o>&gt;=</span> <span class=n>step</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>pulse_width</span> <span class=o>-=</span> <span class=n>step</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>pulse_width</span> <span class=o>=</span> <span class=n>step</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>dir</span> <span class=o>=</span> <span class=mi>1U</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>k_sleep</span><span class=p>(</span><span class=nf>K_MSEC</span><span class=p>(</span><span class=n>SLEEP_MSEC</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// toggle_led 會透過 GPIO pin toggle 的方式，使 LED 閃爍
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>toggle_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>gpio_pin_toggle_dt</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>k_sleep</span><span class=p>(</span><span class=nf>K_MSEC</span><span class=p>(</span><span class=n>SLEEP_TIME_MS</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 檢查 PWM 裝置是否 ready
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>pwm_is_ready_dt</span><span class=p>(</span><span class=o>&amp;</span><span class=n>pwm_led0</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printk</span><span class=p>(</span><span class=s>&#34;Error: PWM device %s is not ready</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>pwm_led0</span><span class=p>.</span><span class=n>dev</span><span class=o>-&gt;</span><span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 設定 GPIO pin 為輸出
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>gpio_pin_configure_dt</span><span class=p>(</span><span class=o>&amp;</span><span class=n>led1</span><span class=p>,</span> <span class=n>GPIO_OUTPUT_ACTIVE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// main 函式結束後，兩個 K_THREAD_DEFINE 建立的執行緒依然會持續執行
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=在執行期run-time動態建立執行緒範例>在執行期（Run Time）動態建立執行緒範例</h3><p>若想要在程式執行的過程中（例如：由某個事件觸發）再建立執行緒，可以使用以下的做法：
1. 用 <code>K_THREAD_STACK_DEFINE(my_stack_area, STACK_SIZE)</code>; 定義stack。
2. 定義一個 struct k_thread my_thread_data; 作為執行緒控制區塊（Thread Control Block, TCB）。
3. 呼叫 k_thread_create()，傳入上述的stack、控制區塊、進入點函式及其他參數來完成建立。</p><p>以下是一個範例，展示如何在 main() 函式中動態建立執行緒（此示例僅顯示與執行緒有關的部分，省略週邊初始化等重複程式碼）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=err>\</span><span class=o>*</span> 
</span></span><span class=line><span class=cl><span class=err>前面的程式碼相同</span>
</span></span><span class=line><span class=cl><span class=o>*</span>\
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 宣告執行緒stack size
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=nf>K_THREAD_STACK_DEFINE</span><span class=p>(</span><span class=n>fade_stack</span><span class=p>,</span> <span class=mi>512</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=nf>K_THREAD_STACK_DEFINE</span><span class=p>(</span><span class=n>toggle_stack</span><span class=p>,</span> <span class=mi>512</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 宣告執行緒控制區塊
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=k>struct</span> <span class=n>k_thread</span> <span class=n>fade_thread_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>struct</span> <span class=n>k_thread</span> <span class=n>toggle_thread_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 這兩個函式和之前範例雷同
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>fade_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>toggle_led</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>p1</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p2</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>p3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在執行期動態建立 fade_led thread
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>k_tid_t</span> <span class=n>fade_tid</span> <span class=o>=</span> <span class=nf>k_thread_create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=n>fade_thread_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>my_fade_stack</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nf>K_THREAD_STACK_SIZEOF</span><span class=p>(</span><span class=n>my_fade_stack</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>fade_led</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>K_NO_WAIT</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 在執行期動態建立 toggle_led thread
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>k_tid_t</span> <span class=n>toggle_tid</span> <span class=o>=</span> <span class=nf>k_thread_create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=n>toggle_thread_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>my_toggle_stack</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nf>K_THREAD_STACK_SIZEOF</span><span class=p>(</span><span class=n>my_toggle_stack</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>toggle_led</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>K_NO_WAIT</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// k_thread_create 回傳 k_tid_t，可用於後續管理 thread
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 例如 k_thread_suspend(fade_tid), k_thread_resume(fade_tid), k_thread_abort(fade_tid)...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=比較>比較</h2><div class=table-wrapper><table><thead><tr><th>建立方式</th><th>特點</th><th>典型使用時機</th></tr></thead><tbody><tr><td>Compile Time 建立</td><td><code>K_THREAD_DEFINE()</code></td><td>一開始已知需要的執行緒，以及系統資源充足時</td></tr><tr><td>Run Time 動態建立</td><td><code>k_thread_create()</code>，在程式執行時期再分配資源</td><td>不確定需要多少執行緒，或需要彈性創建／釋放</td></tr></tbody></table></div><ol><li>如果確定在整個系統的生命週期中，執行緒數量固定，或是系統比較單純（例如一個簡單的多任務控制），用編譯期方式能減少程式碼的複雜度，也能讓程式一啟動就快速就緒。</li><li>如果系統中會動態產生／取消某些任務（如：偵測到新裝置才開新任務等），就可以使用動態建立的方式，提高系統彈性。</li></ol><h2 id=總結>總結</h2><ul><li>靜態（編譯期）建立執行緒：<ul><li>使用 <code>K_THREAD_DEFINE()</code></li><li>簡單、快速、程式架構清晰</li><li>適用於固定且少數的長期執行緒</li></ul></li><li>動態（執行期）建立執行緒：<ul><li>使用 <code>k_thread_create()</code></li><li>需要自行管理堆疊、控制區塊等</li><li>適用於需要彈性創建和銷毀大量或不定數量執行緒的應用場景</li></ul></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/embedded/>Embedded</a>
<a href=/tags/rtos/>RTOS</a>
<a href=/tags/zephyr/>Zephyr</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E5%B8%B8%E8%A6%8B-real-time-os-%E4%BB%8B%E7%B4%B9%E8%88%87%E6%AF%94%E8%BC%83/><div class=article-image><img src=https://i.imgur.com/7SJYZ3b.jpg loading=lazy data-key data-hash=https://i.imgur.com/7SJYZ3b.jpg></div><div class=article-details><h2 class=article-title>常見 Real-Time OS 介紹與比較</h2></div></a></article><article class=has-image><a href=/p/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%B3%BB%E7%B5%B1%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B9%BE%E7%A8%AEmcu/><div class=article-image><img src=https://i.imgur.com/xEqWwbo.jpg loading=lazy data-key data-hash=https://i.imgur.com/xEqWwbo.jpg></div><div class=article-details><h2 class=article-title>嵌入式系統常用的幾種MCU</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugoshih.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 Hsing-Yu Shih</section><section class=powerby></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>